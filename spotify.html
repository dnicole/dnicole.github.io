<html>
	<head>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_purple-yellow.min.css">
		<link rel="stylesheet" href="custom-styles.css">
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
		<!-- Uses a transparent header that draws on top of the layout's background -->
	</head>

	<body>
		<section class="demo-layout-transparent mdl-layout mdl-js-layout">
			<header class="mdl-layout__header mdl-layout__header--transparent mdl-layout__header--scroll mdl-layout--large-screen-only">
				<div class="mdl-layout__header-row">
					<!-- Title -->
					<span class="mdl-layout-title">Nicole Pank</span>
					<!-- Add spacer, to align navigation to the right -->
					<div class="mdl-layout-spacer"></div>
					<!-- Navigation -->
					<nav class="mdl-navigation">
						<a class="mdl-navigation__link" href="/spotify.html">Fun With Our Spotify Data</a>
						<a class="mdl-navigation__link" href="">Link</a>
						<a class="mdl-navigation__link" href="">Link</a>
						<a class="mdl-navigation__link" href="">Link</a>
					</nav>
				</div>
			</header>

			<div class="mdl-layout__drawer mdl-layout--small-screen-only">
				<span class="mdl-layout-title">Nicole Pank</span>
				<nav class="mdl-navigation">
					<a class="mdl-navigation__link" href="">Link</a>
					<a class="mdl-navigation__link" href="">Link</a>
					<a class="mdl-navigation__link" href="">Link</a>
					<a class="mdl-navigation__link" href="">Link</a>
				</nav>
			</div>

			<main class="mdl-layout__content">
				<div class="mdl-grid custom-body">

					<div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet">
						<h1>Displaying User Data</h1>
					</div>

					<div class="mdl-cell mdl-cell--2-col mdl-cell--5-offset-desktop  mdl-cell--3-offset-tablet mdl-cell--12-col-phone">
						<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" id="button-login">Login</button>
					</div>

					<div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet">

					<p>
					  Log in with your Spotify account and this demo will display information about you fetched using the Spotify Web API.
					</p>

					<div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet" id="result"></div>
					</div>
				</div>
			</main>
		</section>
	</body>

	<script id="result-template" type="text/x-handlebars-template">
		<dl>
			<img src="{{images.0.url}}">
			<dt>User Name</dt>
			<dd>{{id}}</dd>
			<dt>Display Name</dt>
			<dd>{{display_name}}</dd>
			<dt>Country</dt>
			<dd>{{country}}</dd>
			<dt>Followers</dt>
			<dd>{{followers.total}}</dd>
			<dt>Profile</dt>
			<dd><a href="{{external_urls.spotify}}" target="_blank">{{external_urls.spotify}}</a></dd>
			<dt>Email</dt>
			<dd>{{email}}</dd>
			<dt>Product</dt>
			<dd>{{product}}</dd>
		</dl>
	</script>

	<script>
	(function() {

	  function login(callback) {
		  var CLIENT_ID = '15f1fcf14a2c4f379f06540e654a9c0e';
		  var REDIRECT_URI = "https://dnicole.github.io//spotify.html";

		  function getLoginURL(scopes) {
			  return 'https://accounts.spotify.com/authorize?client_id=' + CLIENT_ID +
				'&redirect_uri=' + encodeURIComponent(REDIRECT_URI) +
				'&scope=' + encodeURIComponent(scopes.join(' ')) +
				'&response_type=token';
		  }

		  var url = getLoginURL([
			  'playlist-read-private'
		  ]);

		  var width = 450,
			  height = 730,
			  left = (screen.width / 2) - (width / 2),
			  top = (screen.height / 2) - (height / 2);

		  window.addEventListener("message", function(event) {
			  var hash = JSON.parse(event.data);
			  if (hash.type == 'access_token') {
				  callback(hash.access_token);
			  }
		  }, false);

		  var w = window.open(url,
							  'Spotify',
							  'menubar=no,location=no,resizable=no,scrollbars=no,status=no, width=' + width + ', height=' + height + ', top=' + top + ', left=' + left
							 );

	  }

	  function getUserData(accessToken) {
		  return $.ajax({
			  url: 'https://api.spotify.com/v1/me',
			  headers: {
				 'Authorization': 'Bearer ' + accessToken
			  }
		  });
	  }

	  var templateSource = document.getElementById('result-template').innerHTML,
		  template = Handlebars.compile(templateSource),
		  resultsPlaceholder = document.getElementById('result'),
		  loginButton = document.getElementById('button-login');

	  loginButton.addEventListener('click', function() {
		  login(function(accessToken) {
			  getUserData(accessToken)
				  .then(function(response) {
					  loginButton.style.display = 'none';
					  resultsPlaceholder.innerHTML = template(response);
				  });
			  });
	  });

	})();

	</script>

</html>



